#!/usr/bin/env bash
set -e

# Activate the smartspim_stitch environment for the first part
source /opt/conda/bin/activate smartspim_stitch

# Run with first env
big_stitcher_json=$(python run_capsule.py)

echo "Running BigStitcher with JSON: $big_stitcher_json"

# Deactivate current environment
conda deactivate

# Activate bigstitcher_env for the second part
source /opt/conda/bin/activate bigstitcher_env

# Run the second command directly (no need for conda run since we've already activated)
python -m aind_exaspim_pipeline_utils.imagej_wrapper \
    --input_json "$big_stitcher_json" \
    --log_level "DEBUG" \
    --results_path ../results \
    --parallel 16