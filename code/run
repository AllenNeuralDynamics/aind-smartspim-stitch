
#!/usr/bin/env bash
set -e

# Unset any potentially problematic environment variables
unset PYTHONPATH
unset PYTHONHOME
unset PYTHONSTARTUP
unset PYTHONUSERBASE
export PIP_CONFIG_FILE=/dev/null

# Run the first part with smartspim_stitch environment
big_stitcher_json=$(/etc/entrypoint-scripts/activate_smartspim_stitch.sh python run_capsule.py)

echo "Running BigStitcher with JSON: $big_stitcher_json"

# Run the second part with bigstitcher_env environment
/etc/entrypoint-scripts/activate_bigstitcher.sh python -m aind_exaspim_pipeline_utils.imagej_wrapper \
    --input_json "$big_stitcher_json" \
    --log_level "DEBUG" \
    --results_path ../results \
    --parallel 16